<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Voice Speech</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;1,700&display=swap');

*{
    margin:0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
    outline:none;
    border: none;
}

*::-webkit-scrollbar{
    width:5px;
    background:transparent;
}
*::-webkit-scrollbar-thumb{
    background:#777777;
    border-radius:10px;
}
.container{
    width: 100%;
    height:100vh;
    background: linear-gradient(to bottom right, #4527a0, #673ab7);
    display:flex;
    padding:20px;
}

.wrapper{
    margin:auto;
    width:550px;
    padding:1.5rem;
    background:#fff;
    border-radius:10px;
}
.input_field{
    width:100%;
    margin-bottom:20px;
}

.input_field label{
    display:block;
    margin-bottom:10px;
    font-size: 20px;
}

.input_field :is(select,textarea){
    width:100%;
    border:2px solid #f5f5f5;
    border-radius:10px;
    font-size:18px;
    padding:15px 20px;
}

.input_field textarea{
    resize:none;
    height:200px;
}

 .input_field_row{
    display:flex;
    align-items:center;
    gap:20px;
}

.input_field_row .input_col{
    flex:1;
}

.input_col input[type="range"]{
    width:70%;
    height:10px;
}

.input_col span{
    margin-left:10px;
    font-size:18px;
}

.input_col button{
    all:unset;
    width:100%;
    height:60px;
    font-size:1.4em;
    cursor:pointer;
    background: linear-gradient(to bottom right, #4527a0, #673ab7);
    text-align: center;
    color:#fff;
    border-radius: 5px;
    margin-top: 20px;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="wrapper">
            <form onsubmit="return false;">
                <div class="input_field">
                    <label>Upload Text/PDF File or Write Text</label>
                    <input type="file" id="fileUpload" accept=".txt,.pdf">
                    <textarea id="text" placeholder="Write your text here or upload a file"></textarea>
                </div>

                <div class="input_field">
                    <label>Select voices</label>
                    <select id="voice"></select>
                </div>

                <div class="input_field input_field_row">
                    <div class="input_col">
                        <label>Volume</label>
                        <input type="range" id="volume" max="1" min="0" value="1" step="0.1">
                        <span id="volume_amount">1.0</span>
                    </div>
                    <div class="input_col">
                        <label>Rate</label>
                        <input type="range" id="rate" max="3" min="0" value="1" step="0.1">
                        <span id="rate_amount">1.0</span>
                    </div>
                    <div class="input_col">
                        <label>Pitch</label>
                        <input type="range" id="pitch" max="1" min="0" value="1" step="0.1">
                        <span id="pitch_amount">1.0</span>
                    </div>
                </div>

                <div class="input_field input_field_row">
                    <div class="input_col">
                        <button id="play">Play</button>
                    </div>
                    <div class="input_col">
                        <button id="pause">Pause</button>
                    </div>
                    <div class="input_col">
                        <button id="resume">Resume</button>
                    </div>
                    <div class="input_col">
                        <button id="reset">Reset</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

   <script>
    const text = document.getElementById("text"),
      fileUpload = document.getElementById("fileUpload"),
      voiceSelectBox = document.getElementById("voice"),
      volume = document.getElementById("volume"),
      rate = document.getElementById("rate"),
      pitch = document.getElementById("pitch"),
      playBtn = document.getElementById("play"),
      pauseBtn = document.getElementById("pause"),
      resumeBtn = document.getElementById("resume"),
      resetBtn = document.getElementById("reset"),
      volume_amount = document.getElementById("volume_amount"),
      rate_amount = document.getElementById("rate_amount"),
      pitch_amount = document.getElementById("pitch_amount");

let speech = new SpeechSynthesisUtterance(text.value);
speech.lang = 'en';

let voicesOptions = [];

// File upload handling
fileUpload.addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const fileType = file.name.split('.').pop().toLowerCase();
    
    try {
        if (fileType === 'txt') {
            // Read text file
            const reader = new FileReader();
            reader.onload = function(e) {
                text.value = e.target.result;
            };
            reader.readAsText(file);
        } else if (fileType === 'pdf') {
            // Read PDF file
            const reader = new FileReader();
            reader.onload = async function(e) {
                const pdfData = new Uint8Array(e.target.result);
                const pdf = await pdfjsLib.getDocument({data: pdfData}).promise;
                let fullText = '';

                // Extract text from all pages
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }

                text.value = fullText;
            };
            reader.readAsArrayBuffer(file);
        }
    } catch (error) {
        console.error('Error reading file:', error);
        alert('Error reading file. Please try again.');
    }
});

// Voice selection setup
window.speechSynthesis.onvoiceschanged = function() {
    voicesOptions = window.speechSynthesis.getVoices();
    speech.voice = voicesOptions[0];  // setting default voice
    voicesOptions.forEach(function(systemVoice, index) {
        voiceSelectBox.options[index] = new Option(systemVoice.name, index); // setting options in select box
    });
};

voiceSelectBox.addEventListener("change", function() {
    speech.voice = voicesOptions[voiceSelectBox.value];
});

// Volume, rate, and pitch controls
volume.addEventListener("input", function() {
    speech.volume = volume.value;
    volume_amount.innerText = volume.value;
});

rate.addEventListener("input", function() {
    speech.rate = rate.value;
    rate_amount.innerText = rate.value;
});

pitch.addEventListener("input", function() {
    speech.pitch = pitch.value;
    pitch_amount.innerText = pitch.value;
});

// Playback controls
playBtn.addEventListener("click", function() {
    speech.text = text.value;
    window.speechSynthesis.speak(speech);
});

pauseBtn.addEventListener("click", () => window.speechSynthesis.pause());
resumeBtn.addEventListener("click", () => window.speechSynthesis.resume());
resetBtn.addEventListener("click", () => window.speechSynthesis.cancel());
   </script>
</body>
</html>